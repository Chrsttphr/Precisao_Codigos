Sub Format5Digits_ToText_NoCellLoop()
    Dim rng As Range
    Dim rngConstants As Range
    Dim area As Range
    Dim fmla As String

    ' Seleciona o intervalo diretamente
    On Error Resume Next
    Set rng = Application.InputBox( _
        Prompt:="Selecione o intervalo que deseja converter para texto com 5 d√≠gitos:", _
        Type:=8)
    On Error GoTo 0

    If rng Is Nothing Then
        MsgBox "Nenhum intervalo selecionado.", vbExclamation
        Exit Sub
    End If

    ' Considera apenas c√©lulas sem f√≥rmula (constantes)
    On Error Resume Next
    Set rngConstants = rng.SpecialCells(xlCellTypeConstants)
    On Error GoTo 0

    If rngConstants Is Nothing Then
        MsgBox "O intervalo selecionado n√£o cont√©m c√©lulas constantes (sem f√≥rmulas).", vbInformation
        Exit Sub
    End If

    Application.ScreenUpdating = False
    Application.EnableEvents = False
    Application.Calculation = xlCalculationManual

    ' Garante que o resultado seja texto
    rngConstants.NumberFormat = "@"

    ' Monta express√£o TEXT via Evaluate e aplica por √Årea (n√£o √© c√©lula a c√©lula)
    For Each area In rngConstants.Areas
        ' Constr√≥i f√≥rmula matricial: TEXT(valor,"00000") preservando c√©lulas vazias
        fmla = "IF(" & area.Address(0, 0) & "="""","""",TEXT(" & area.Address(0, 0) & ",""00000""))"
        area.Value = Evaluate(fmla)
    Next area

    Application.ScreenUpdating = True
    Application.EnableEvents = True
    Application.Calculation = xlCalculationAutomatic

    MsgBox "Convers√£o para texto com 5 d√≠gitos conclu√≠da nas c√©lulas constantes.", vbInformation
End Sub

‚úÖ O que a macro faz
Permite selecionar o intervalo na planilha
Abre um InputBox de sele√ß√£o para voc√™ escolher, com o mouse, o intervalo a ser convertido para texto com 5 d√≠gitos.

Considera apenas c√©lulas sem f√≥rmulas
Usa SpecialCells(xlCellTypeConstants) para filtrar o intervalo e ignorar c√©lulas com f√≥rmulas, evitando alterar resultados calculados.

Melhora a performance durante a execu√ß√£o
Desativa atualiza√ß√£o de tela, eventos e coloca a recalcular em modo manual para acelerar o processamento.

Garante que a sa√≠da seja texto
Aplica NumberFormat = "@" no intervalo de constantes para que os valores fiquem armazenados como texto (essencial para c√≥digos/IDs).

Converte em blocos, sem percorrer c√©lula a c√©lula
Divide o intervalo em √°reas cont√≠guas (rngConstants.Areas).
Para cada √°rea, constr√≥i uma express√£o com Evaluate que aplica:

TEXT(valor,"00000") ‚Üí Formata com 5 d√≠gitos e zeros √† esquerda.
IF(c√©lula="","",...) ‚Üí Preserva c√©lulas vazias.

Essa t√©cnica preenche toda a √°rea de uma vez, sem usar For Each cell, o que √© mais r√°pido.

Restaura as configura√ß√µes
Reativa a atualiza√ß√£o de tela, eventos e recalcula√ß√£o autom√°tica.

Exibe mensagem final
Mostra: "Convers√£o para texto com 5 d√≠gitos conclu√≠da nas c√©lulas constantes."

‚úÖ Para que serve
Padronizar c√≥digos/IDs como texto com exatamente 5 caracteres, preenchendo com zeros √† esquerda quando necess√°rio.
Exemplos:

7 ‚Üí "00007"
123 ‚Üí "00123"

Ideal quando o dado n√£o deve ser tratado como n√∫mero (para evitar perda de zeros √† esquerda ou altera√ß√µes por c√°lculo).

‚úÖ Benef√≠cios
Sem loop por c√©lula: A opera√ß√£o √© vetorizada via Evaluate, ganhando desempenho.
Protege f√≥rmulas: N√£o altera c√©lulas que possuem f√≥rmulas.
Padroniza√ß√£o garantida: Todos os valores terminam como texto com 5 d√≠gitos.
Preserva vazios: C√©lulas em branco continuam vazias.

‚ö†Ô∏è Pontos de aten√ß√£o
Somente constantes: Se o intervalo selecionado tiver apenas f√≥rmulas, a macro n√£o executa (exibe aviso).
Valores n√£o num√©ricos: TEXT funciona com n√∫meros; se houver textos como ABC, permanecer√£o em branco pela l√≥gica aplicada (por causa do IF).
Se quiser que textos num√©ricos ("123") tamb√©m virem "00123", est√° coberto; mas textos alfanum√©ricos permanecer√£o vazios.
Mais de 5 d√≠gitos: N√∫meros com mais de 5 d√≠gitos n√£o s√£o truncados pelo TEXT; ser√£o mostrados completos (ex.: 123456 ‚Üí "123456"). Se voc√™ quiser truncar ou validar comprimento, posso incluir uma regra.

üõ†Ô∏è Trecho-chave explicando a convers√£o sem c√©lula a c√©lula
Plain Textvba n√£o tem suporte total. O realce de sintaxe √© baseado em

For Each area In rngConstants.Areas    
' F√≥rmula matricial aplicada √† √°rea inteira:    
' Se c√©lula estiver vazia -> mant√©m vazia    
' Caso contr√°rio -> aplica TEXT(..., "00000")    
fmla = "IF(" & area.Address(0, 0) & "="""","""",TEXT(" & area.Address(0, 0) & ",""00000""))"    
area.Value = Evaluate(fmla)
Next area

area.Address(0, 0) retorna o endere√ßo relativo da √°rea (ex.: B2:B100).
Evaluate(fmla) cria uma matriz com o resultado para toda a √°rea e atribui de uma vez.
