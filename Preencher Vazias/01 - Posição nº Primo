
Option Explicit

' Fun√ß√£o para calcular o n-√©simo n√∫mero primo
Public Function NEsimoPrimo(n As Long) As Long
    Dim upper As Long, i As Long, j As Long, count As Long
    Dim isComposite() As Boolean
    
    If n < 1 Then
        NEsimoPrimo = CVErr(xlErrValue)
        Exit Function
    End If
    
    ' Estimativa do limite superior usando logaritmo natural
    upper = n * (Log(n) + Log(Log(n))) + 50
    ReDim isComposite(0 To upper)
    
    ' Crivo de Erat√≥stenes
    For i = 2 To Sqr(upper)
        If Not isComposite(i) Then
            For j = i * i To upper Step i
                isComposite(j) = True
            Next j
        End If
    Next i
    
    ' Conta os primos at√© achar o n-√©simo
    count = 0
    For i = 2 To upper
        If Not isComposite(i) Then
            count = count + 1
            If count = n Then
                NEsimoPrimo = i
                Exit Function
            End If
        End If
    Next i
End Function

=NEsimoPrimo(10)   ' Retorna 29
=NEsimoPrimo(192834) ' Retorna o 192.834¬∫ primo

‚úÖ O que a fun√ß√£o faz
Valida a entrada
Se n < 1, retorna erro de planilha (#VALUE!) para indicar par√¢metro inv√°lido.

Estima um limite superior para busca
Calcula upper = n * (Log(n) + Log(Log(n))) + 50, uma aproxima√ß√£o do valor do n‚Äë√©simo primo usando logaritmos naturais (PNT ‚Äì Teorema dos N√∫meros Primos).
Essa estimativa define at√© onde o algoritmo precisa verificar.

Inicializa a estrutura de marca√ß√£o
Cria um array booleano isComposite(0 To upper) onde:

False = potencial primo
True = composto (n√£o primo)

Executa o Crivo de Erat√≥stenes
Percorre de i = 2 at√© Sqr(upper) e, para cada i n√£o marcado como composto:

Marca todos os m√∫ltiplos j = i * i, i * i + i, ... como compostos.
Isso elimina rapidamente n√∫meros n√£o primos.

Conta e retorna o n‚Äë√©simo primo
Varre de 2 at√© upper:

Cada n√∫mero n√£o composto (Not isComposite(i)) √© primo ‚Üí incrementa count.
Quando count = n, retorna i, que √© o n‚Äë√©simo n√∫mero primo.

‚úÖ Para que serve
Obter o n‚Äë√©simo n√∫mero primo diretamente em f√≥rmulas do Excel, por exemplo:
Excel=NEsimoPrimo(1)    ' 2=NEsimoPrimo(10)   ' 29=NEsimoPrimo(100)  ' 541Mostrar mais linhas
√ötil para estudos, valida√ß√µes, gera√ß√£o de chaves pseudo‚Äëaleat√≥rias baseadas em primos, e problemas matem√°ticos.

‚úÖ Benef√≠cios
R√°pido e eficiente: Usa o Crivo de Erat√≥stenes, ideal para grandes intervalos.
Autossuficiente: N√£o depende de bibliotecas externas; s√≥ VBA/Excel.
Escal√°vel: A estimativa de limite evita varrer n√∫meros desnecess√°rios.

‚ö†Ô∏è Pontos de aten√ß√£o
Mem√≥ria: Para n muito grande, o array isComposite(0 To upper) pode ocupar bastante mem√≥ria (pois cresce com upper).
Estimativa: A f√≥rmula de upper √© uma aproxima√ß√£o com margem (+50). Em raros casos extremos, pode ser necess√°rio aumentar a margem se n√£o encontrar o n‚Äë√©simo primo.
Tipo de entrada: n deve ser inteiro positivo. Valores fracion√°rios ou texto resultar√£o em erro.

üõ†Ô∏è Trecho‚Äëchave (Crivo e contagem)
' Crivo de Erat√≥stenes
    For i = 2 To Sqr(upper)    
        If Not isComposite(i) Then        
            For j = i * i To upper Step i            
                isComposite(j) = True        
            Next j    
        End If
    Next i
' Conta os primos at√© achar o n-√©simo
count = 0
    For i = 2 To upper    
        If Not isComposite(i) Then        
            count = count + 1        
            If count = n Then            
                NEsimoPrimo = i            
                Exit Function        
            End If    
        End If
    Next i
